<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gulf Andhra</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    /* Your existing CSS styles remain the same */
    /* ... */
  </style>
</head>
<body>
  <div class="header-container">
    <!-- Gold Price Ticker -->
    <div class="ticker-bar">
      <div class="ticker-content">
        <div class="date-display" id="telugu-date"></div>
        <marquee scrollamount="6" class="ticker-marquee" id="gold-ticker">
          <!-- Content will be populated by JavaScript -->
          <span class="ticker-item welcome-message">Welcome Gulf Andhra</span>
          <span class="ticker-separator">•</span>
          <span class="ticker-item gold-price"><i class="fas fa-coins gold-icon"></i> Loading gold prices...</span>
        </marquee>
      </div>
    </div>
    
    <!-- Main Header -->
    <div class="main-header">
      <div class="logo-container">
        <img src="/images/logo.png" alt="Gulf Andhra Logo" class="logo">
        <div class="header-text">
          <h1>Gulf</h1>
          <p>A n d h r a</p>
        </div>
      </div>
    </div>
    
    <!-- Your existing navigation will go here -->
  </div>

  <script>
    // Function to fetch and parse CSV data
    async function fetchGoldPrices() {
      try {
        const response = await fetch('/data/gold_prices.csv');
        const csvData = await response.text();
        return parseCSV(csvData);
      } catch (error) {
        console.error('Error fetching gold prices:', error);
        return null;
      }
    }

    // Function to parse CSV data
    function parseCSV(csv) {
      const lines = csv.split('\n');
      const headers = lines[0].split(',');
      const result = [];
      
      for (let i = 1; i < lines.length; i++) {
        if (!lines[i]) continue;
        
        const obj = {};
        const currentLine = lines[i].split(',');
        
        for (let j = 0; j < headers.length; j++) {
          obj[headers[j]] = currentLine[j];
        }
        
        result.push(obj);
      }
      
      return result;
    }

    // Function to get latest prices for each location
    function getLatestPrices(data) {
      const latestPrices = {};
      
      // Group by location
      const locations = {};
      data.forEach(row => {
        if (!locations[row.Location]) {
          locations[row.Location] = [];
        }
        locations[row.Location].push(row);
      });
      
      // Get latest for each location
      for (const location in locations) {
        // Sort by date (newest first)
        locations[location].sort((a, b) => new Date(b.Date) - new Date(a.Date));
        latestPrices[location] = locations[location][0];
      }
      
      return latestPrices;
    }

    // Function to update the ticker with gold prices
    function updateTicker(prices) {
      const ticker = document.getElementById('gold-ticker');
      if (!ticker) return;
      
      // Get Hyderabad price (22K)
      const hyderabad = prices['Hyderabad'];
      const saudi = prices['Saudi Arabia'];
      const uae = prices['UAE'];
      const qatar = prices['Qatar'];
      const kuwait = prices['Kuwait'];
      const oman = prices['Oman'];
      const bahrain = prices['Bahrain'];
      
      // Create ticker items
      let tickerHTML = `
        <span class="ticker-item welcome-message">Welcome Gulf Andhra</span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price"><i class="fas fa-coins gold-icon"></i> 22K Gold Hyderabad: <strong>₹${hyderabad['22K']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">Saudi: <strong>₹${Math.round(saudi['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">UAE: <strong>₹${Math.round(uae['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">Qatar: <strong>₹${Math.round(qatar['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">Kuwait: <strong>₹${Math.round(kuwait['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">Oman: <strong>₹${Math.round(oman['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item gold-price">Bahrain: <strong>₹${Math.round(bahrain['INR_Equivalent'])}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price"><i class="fas fa-money-bill-wave exchange-icon"></i> SAR: <strong>₹${saudi['Exchange_price']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price">AED: <strong>₹${uae['Exchange_price']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price">QAR: <strong>₹${qatar['Exchange_price']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price">KWD: <strong>₹${kuwait['Exchange_price']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price">OMR: <strong>₹${oman['Exchange_price']}</strong></span>
        <span class="ticker-separator">•</span>
        <span class="ticker-item exchange-price">BHD: <strong>₹${bahrain['Exchange_price']}</strong></span>
      `;
      
      ticker.innerHTML = tickerHTML;
    }

    // Main function to load and display prices
    async function loadGoldPrices() {
      const csvData = await fetchGoldPrices();
      if (csvData) {
        const latestPrices = getLatestPrices(csvData);
        updateTicker(latestPrices);
      } else {
        console.error('Could not load gold prices');
      }
    }

    // Adjust marquee scroll speed for mobile
    function adjustMarqueeSpeed() {
      const marquee = document.querySelector('.ticker-marquee');
      if (!marquee) {
        console.error('Marquee element not found');
        return;
      }
      console.log('Adjusting marquee speed, window width:', window.innerWidth);
      const isMobile = window.innerWidth <= 768;
      const newScrollAmount = isMobile ? '1' : '6';
      marquee.setAttribute('scrollamount', newScrollAmount);
      console.log('Set scrollamount to:', newScrollAmount);
      // Force marquee re-render by stopping and starting
      marquee.stop();
      setTimeout(() => marquee.start(), 0);
    }

    // Run on load and resize
    window.addEventListener('load', () => {
      console.log('Page loaded, running adjustMarqueeSpeed');
      adjustMarqueeSpeed();
      loadGoldPrices();
    });
    window.addEventListener('resize', () => {
      console.log('Window resized, running adjustMarqueeSpeed');
      adjustMarqueeSpeed();
    });
  </script>
</body>
</html>
